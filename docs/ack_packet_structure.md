# Структура ACK-пакета

Эта схема описывает минимальный кадр подтверждения, который формируется модулем передачи. Общий формат следует стандартному заголовку `FrameHeader`, после которого располагается полезная нагрузка ACK.

## Заголовок кадра

| Смещение (байт) | Размер | Поле          | Описание |
|-----------------|--------|---------------|----------|
| 0               | 1      | `ver`         | Версия протокола (текущее значение `1`). |
| 1               | 1      | `flags`       | Флаги кадра. Для ACK выставляются только служебные биты: `FLAG_ACK_REQUIRED` не используется, поскольку ответ не требует подтверждения. |
| 2               | 4      | `msg_id`      | Идентификатор сообщения. Для ACK выделяется отдельный диапазон `>= 0x80000000`, чтобы не конфликтовать с обычными отправками. |
| 6               | 2      | `frag_idx`    | Индекс фрагмента. Для ACK всегда `0`. |
| 8               | 2      | `frag_cnt`    | Число фрагментов. Для ACK всегда `1`. |
| 10              | 2      | `payload_len` | Длина полезной нагрузки (для минимального варианта равна `1`). |
| 12              | 4      | `ack_mask`    | Зарезервировано под маску подтверждённых сообщений, сейчас остаётся `0`. |
| 16              | 2      | `hdr_crc`     | CRC16 заголовка. |
| 18              | 2      | `frame_crc`   | CRC16 всего кадра. |

## Полезная нагрузка

ACK-пакет передаёт один байт `0x06` — константу `protocol::ack::MARKER`. Это минимальный маркер подтверждения, который не проходит дополнительное шифрование или свёрточное кодирование.

```
+---------+
| 0x06    | ← `MARKER`
+---------+
```

Модуль приёма также принимает устаревший текстовый вариант `"ACK"` (включая варианты с префиксом `[TAG|N]`), однако при формировании ответов передаётся именно однобайтовый маркер.

## Логика использования

1. При получении пользовательского кадра и включённом режиме подтверждений приёмник формирует ACK с маркером `0x06`.
2. ACK ставится в выделенную очередь `ack_queue_` и отправляется с приоритетом перед остальными сообщениями.
3. Приёмник определяет ACK по функции `protocol::ack::isAckPayload(...)`, которая распознаёт как бинарный маркер, так и совместимые текстовые варианты.

Эта структура обеспечивает минимальный размер кадра и совместимость со старыми клиентами, где ещё использовалась текстовая строка `"ACK"`.
